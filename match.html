<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Match Details</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="images/icon.png">
</head>
<body>
    <div class="app-container">
        <div class="details">
            <h1>Match Details</h1>
        </div>
        <div id="matchDetails">Loading...</div>
        <div class="back">
            <a href="index.html">Back to search</a>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { Request } from "./Request.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAoH-r85ybXVvw6Klt_vPXPy0HgbnT7Oq0",
            authDomain: "carpool-party-5bf47.firebaseapp.com",
            projectId: "carpool-party-5bf47",
            storageBucket: "carpool-party-5bf47.appspot.com",
            messagingSenderId: "224912194414",
            appId: "1:224912194414:web:75a1c4ffb86a3966d8df7f",
            measurementId: "G-7KJLFX0PK4"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function getQueryParam(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }

        function formatTime(hour) {
            // hour is 0-23
            let ampm = hour >= 12 ? 'PM' : 'AM';
            let h = hour % 12;
            if (h === 0) h = 12;
            return `${h} ${ampm}`;
        }

        async function loadMatch() {
            const matchId = getQueryParam('matchId');
            if (!matchId) {
                document.getElementById('matchDetails').innerText = 'No match selected.';
                return;
            }
            const docRef = doc(db, "requests", matchId);
            const docSnap = await getDoc(docRef);
            if (!docSnap.exists()) {
                document.getElementById('matchDetails').innerText = 'Match not found.';
                return;
            }
            const d = docSnap.data();
            const name = d.name || getQueryParam('name');
            const email = d.email || getQueryParam('email');
            const day = d.day || getQueryParam('day');
            const timeRaw = d.time || getQueryParam('time');
            let time = timeRaw;
            if (time !== undefined && time !== null && time !== '') {
                time = formatTime(Number(time));
            } else {
                time = '';
            }
            let originDist = d.originDist || getQueryParam('originDist');
            let destDist = d.destDist || getQueryParam('destDist');
            // fix undefined or missing distances
            originDist = originDist && originDist !== 'undefined' ? originDist : '< 0.1';
            destDist = destDist && destDist !== 'undefined' ? destDist : '< 0.1';
            document.getElementById('matchDetails').innerHTML = `
                <div style="background:#f2f2f2;border-radius:8px;padding:1.5em;margin-bottom:1em;box-shadow:0 1px 4px #0001;max-width:400px;margin:auto;">
                    <b>Name:</b> ${name}<br>
                    <b>Email:</b> <a href="mailto:${email}">${email}</a><br>
                    <b>Day:</b> ${day}<br>
                    <b>Time:</b> ${time}<br>
                    <b>Origin distance:</b> ${originDist} mi<br>
                    <b>Destination distance:</b> ${destDist} mi
                </div>
            `;
        }
        loadMatch();
    </script>
</body>
</html>
